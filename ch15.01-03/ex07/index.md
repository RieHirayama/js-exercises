## 問題 15.1-3.7 🖋

自分が運営する販売サイトに YouTube のトップページを iframe で組込み、更に自作の script.js により iframe 内のデータを分析しようとしています。

```html
<iframe id="other" src="https://www.youtube.com/"></iframe>
<script src="./script.js"></script>
...
```

```js
async () => {
  // YouTube が利用者に推薦する動画タイトルを取得すれば、利用者に最適な商品セットを表示できるのではないか？
  const titles = document
    .getElementById("other")
    .contentWindowquerySelectorAll("#video-title");
  for (const t of titles) {
    await fetch("your-server-path", { method: "POST", body: t.textContent });
  }
};
```

しかし、トップページを読み込むとエラーになります。用語「クリックジャッキング」を調べて理由を説明しなさい。<br>
また、script.js も動作しません。ここで、同一オリジンポリシーがなく、iframe 内の他サイトの DOM 変更が可能な仕様を想定し、どのような重大な問題が発生しうるか記載しなさい。

## 回答

### 「クリックジャッキング」とは

透明/偽装した iframe 上にボタン等を重ね、ユーザーに“本物”だと思わせてクリックさせる攻撃
多くの主要サイト（YouTube 含む）は、このクリックジャッキングを防ぐ策が講じられている。

### トップページを読み込むとエラーが出た理由

YouTubeのトップページは、同一オリジンのみ許可、または、許可オリジンを限定という制御により、他サイトからの iframe 埋め込みが拒否される仕組み。
そのため、ブラウザが「フレーミング不可」と判断し、<iframe> の読み込みが失敗（もしくは空白）になる。

### 「同一オリジンポリシー（SOP: Same Origin Policy）」とは

Webブラウザがセキュリティのために導入している仕組みで、「異なるオリジン（＝プロトコル・ホスト・ポートのいずれかが異なる）」間では、JavaScriptなどからDOMやCookieなどの重要なデータにアクセスできないように制限するルール。

### 今回 script.js も動作しない理由

たとえiframeが表示できたとしても、親ページと異なるオリジン（プロトコル/ホスト/ポートのどれかが違う）であれば、同一オリジンポリシー（SOP）により、`contentWindow.document.querySelectorAll(...)` のようなDOM 参照はブロックされる。今回はこのSOPにより、エラーになる。

### SOP がなかったらどのような重大な問題が発生しうるか

SOP が存在しない（他サイトのiframeのDOMを自由に読める/書ける）場合、以下のような攻撃が成立し、プライバシー侵害やデータ漏洩といった問題が発生する。

- プライバシー侵害：ログイン済みの他サイト（動画履歴、購入履歴、メール本文、住所など）のページ内容を読み出して送信できる。
- セッション/アカウント乗っ取り：DOM から CSRF トークンやワンタイムコード等を盗む、フォームを書き換えてユーザーの操作を誘導。
- サイレント操作・不正注文：DOM を書き換えて自動クリックや隠しフォーム送信、強制購買/送金/設定変更を実行。
- パスワード管理ツールの悪用：オートフィル欄を不正に設置・取得する攻撃の成立可能性が上がる。
- フィッシング高度化：正規サイトの DOM をそのまま流用して偽画面を生成、信用を担保しながら入力情報を収集。
- 追跡強化（指紋付与）：他ドメインの詳細情報を突き合わせ、ユーザー識別をより正確にしてトラッキングを強化。
