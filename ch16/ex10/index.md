# 問題16.10 回答

## メモリ使用量の比較
`fs.createReadStream` と `fs.read` で比較。

- `fs.createReadStream` を利用したストリームアップロード
- `fs.readFile` を利用した全読み込み後アップロード

アップロード対象：大容量 file.txt (50MB)

メモリ使用量の計測方法：process.memoryUsage().rss（MB）
- process.memoryUsage() とは
  - Node.js プロセスのメモリ使用状況をオブジェクトで返す関数
  - rssメトリクス プロセスが実際に物理メモリ（RAM）に確保しているメモリサイズ


### 確認結果
メモリ使用量（RSS）

| 方式 | タイミング | RSS (MB) |
|---|---|---:|
| ストリーム（createReadStream） | 開始時 | 32.3 |
| | アップロード完了時 (status=200) | 112.6 |
| | 終了時 | 114.5 |
| readFile（全読み込み） | 開始時 | 114.6 |
| | readFile直後 | 103.3 |
| | アップロード完了時 (status=200) | 196 |
| | 終了時 | 196 |

- ストリーム方式（fs.createReadStream）
開始時は約 32MB と低い状態からスタートした。
アップロード中に RSS は増加したが、約 115MB 程度で収まり、急激な増加は見られなかった。
ファイルを分割して逐次処理しているため、メモリ使用量が比較的安定している。

- readFile方式
アップロード完了時には RSS が約 196MB まで増加した。
fs.readFile によってファイル全体を一度にメモリ上へ展開し、その後送信しているため、メモリ使用量が大きくなったと考えられる。
ストリーム方式と比較して、最大メモリ使用量が大きい。


